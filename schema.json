{"openapi":"3.1.0","info":{"title":"Speaker Attribution API","description":"An API for attributing speakers in a text using advanced AI models.","version":"1.0.0"},"paths":{"/api/v1/jobs/match_speaker":{"post":{"tags":["jobs","jobs"],"summary":"Use LLM to match speaker names","description":"Send a prompt to the LLM to determine if two speaker names refer to the same character.","operationId":"match_speaker_with_llm_api_v1_jobs_match_speaker_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SpeakerMatchRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SpeakerMatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/jobs/":{"post":{"tags":["jobs"],"summary":"Submit a new attribution job","description":"Upload a text file to be processed for speaker attribution. This endpoint returns a job ID immediately.","operationId":"submit_job_api_v1_jobs__post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_submit_job_api_v1_jobs__post"}}},"required":true},"responses":{"202":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobCreateResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/jobs/{job_id}":{"get":{"tags":["jobs"],"summary":"Get job status and result","description":"Poll this endpoint with a job ID to check the status of a processing job. Once completed, the result will be included in the response.","operationId":"get_job_status_api_v1_jobs__job_id__get","parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/llm/models":{"get":{"tags":["llm","llm"],"summary":"List available LLM models","description":"Returns the list of LLM model names available to clients (loaded from a repo-controlled file).","operationId":"list_models_api_v1_llm_models_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response List Models Api V1 Llm Models Get"}}}}}}}},"components":{"schemas":{"AttributionResponse":{"properties":{"segments":{"items":{"$ref":"#/components/schemas/Segment"},"type":"array","title":"Segments","description":"The list of segments with speaker attribution"},"input_tokens":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Input Tokens","description":"Total input tokens used across all LLM calls"},"output_tokens":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Output Tokens","description":"Total output tokens used across all LLM calls"},"thoughts_tokens":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Thoughts Tokens","description":"Total reasoning/thinking tokens used across all LLM calls. Only included if > 0."},"metadata":{"additionalProperties":true,"type":"object","title":"Metadata","description":"Metadata about the processing job"},"extra_info":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Extra Info","description":"Strategy-specific information and settings"},"debug_info":{"anyOf":[{"$ref":"#/components/schemas/DebugInfo"},{"type":"null"}],"description":"Detailed debug information (only included if debug_info was requested)"}},"type":"object","required":["segments"],"title":"AttributionResponse"},"Body_submit_job_api_v1_jobs__post":{"properties":{"file":{"type":"string","format":"binary","title":"File","description":"Text file to process"},"strategy":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Strategy"},"settings_override":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Settings Override","description":"JSON object to override strategy settings"},"book_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Book Name"},"max_sections_inflight":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Max Sections Inflight"},"llm_model":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Llm Model","description":"Optional LLM model name override for this job."},"debug_info":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Debug Info","description":"Request detailed debug information in the response","default":false}},"type":"object","required":["file"],"title":"Body_submit_job_api_v1_jobs__post"},"DebugInfo":{"properties":{"api_call_to_response_time_seconds":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Api Call To Response Time Seconds","description":"Time from API call to API response"},"total_llm_request_time_seconds":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Total Llm Request Time Seconds","description":"Sum of all LLM request execution times"},"llm_calls":{"items":{"$ref":"#/components/schemas/LLMCallDebugInfo"},"type":"array","title":"Llm Calls","description":"Debug info for each LLM call chunk"}},"type":"object","title":"DebugInfo","description":"Debug information for the entire attribution job."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"JobCreateResponse":{"properties":{"job_id":{"type":"string","title":"Job Id","description":"The unique identifier for the created job.","example":"d418d299-09fc-4028-a795-aa3879dc587e"},"status_url":{"type":"string","title":"Status Url","description":"The URL to poll for the job's status and result.","example":"/api/v1/jobs/d418d299-09fc-4028-a795-aa3879dc587e"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Timestamp when the job was created.","example":"2024-01-15T10:30:00Z"},"strategy":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Strategy","description":"The attribution strategy used for this job.","example":"marking"},"book_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Book Name","description":"The name of the book being processed, if provided.","example":"Pride and Prejudice"}},"type":"object","required":["job_id","status_url","created_at"],"title":"JobCreateResponse"},"JobStatusResponse":{"properties":{"job_id":{"type":"string","title":"Job Id","description":"The unique identifier for the job.","example":"d418d299-09fc-4028-a795-aa3879dc587e"},"status":{"type":"string","enum":["processing","completed","failed","PROGRESS"],"title":"Status","description":"The current status of the job."},"result":{"anyOf":[{"$ref":"#/components/schemas/AttributionResponse"},{"type":"null"}],"description":"The result of the speaker attribution. Only present if the job is 'completed'."},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Details of the error. Only present if the job has 'failed'.","example":"An unexpected error occurred during processing."},"progress":{"anyOf":[{"additionalProperties":{"type":"integer"},"type":"object"},{"type":"null"}],"title":"Progress","description":"Details of the job progress, including 'processed' and 'total' counts."}},"type":"object","required":["job_id","status"],"title":"JobStatusResponse"},"LLMCallDebugInfo":{"properties":{"chunk_index":{"type":"integer","title":"Chunk Index","description":"Index of the chunk (0-based)"},"execution_time_seconds":{"type":"number","title":"Execution Time Seconds","description":"Time from LLM call start to response received"},"word_count":{"type":"integer","title":"Word Count","description":"Number of words in the chunk sent to LLM"},"unique_speakers_detected":{"type":"integer","title":"Unique Speakers Detected","description":"Number of unique speakers detected in this chunk's LLM response"},"segment_start_chars":{"items":{"type":"integer"},"type":"array","title":"Segment Start Chars","description":"Character positions where segments start (relative to all text)"},"segment_end_chars":{"items":{"type":"integer"},"type":"array","title":"Segment End Chars","description":"Character positions where segments end (relative to all text)"},"retry_count":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Retry Count","description":"Number of retries attempted for this LLM call"},"finish_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Finish Reason","description":"Reason why the LLM generation finished (e.g., STOP, MAX_TOKENS, SAFETY, etc.)"},"safety_ratings":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Safety Ratings","description":"Content safety filter ratings if available"},"prompt_feedback":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Prompt Feedback","description":"Feedback about the prompt if available"},"response_status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Response Status","description":"Status of the LLM response (success, error, etc.)"},"error_message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error Message","description":"Error message if the call failed"},"response_length":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Response Length","description":"Length of the raw response text"},"response_preview":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Response Preview","description":"First 200 characters of the response for debugging"},"structured_output_enabled":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Structured Output Enabled","description":"Whether Gemini structured output was requested for this call"},"response_mime_type_requested":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Response Mime Type Requested","description":"Requested response MIME type (e.g., application/json)"},"response_schema_summary":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Response Schema Summary","description":"Compact summary of the requested JSON schema (not the full schema)"},"model_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Model Name","description":"Model name used for this call"},"temperature":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Temperature","description":"Temperature setting used for this call"},"prompt_length":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Prompt Length","description":"Length of the prompt sent to LLM"},"input_tokens":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Input Tokens","description":"Number of input tokens used (from API metadata)"},"output_tokens":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Output Tokens","description":"Number of output tokens used (from API metadata)"},"total_tokens":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Total Tokens","description":"Total tokens used (from API metadata)"},"thoughts_tokens":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Thoughts Tokens","description":"Number of thinking/reasoning tokens used (from API metadata)"},"thinking_thoughts":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Thinking Thoughts","description":"The actual thinking/reasoning text from the model (only available if include_thoughts=True was set)"},"tokens_from_api":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Tokens From Api","description":"Whether token counts came from API metadata (True) or were estimated (False)"},"region_used":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Region Used","description":"API region used for this call"}},"type":"object","required":["chunk_index","execution_time_seconds","word_count","unique_speakers_detected"],"title":"LLMCallDebugInfo","description":"Debug information for a single LLM call chunk."},"Segment":{"properties":{"speaker":{"type":"string","title":"Speaker","description":"The identified speaker for the text segment.","example":"narrator"},"text":{"type":"string","title":"Text","description":"The segment of text attributed to the speaker.","example":"It was a dark and stormy night."}},"type":"object","required":["speaker","text"],"title":"Segment"},"SpeakerMatchRequest":{"properties":{"prompt":{"type":"string","title":"Prompt"},"model":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Model"}},"type":"object","required":["prompt"],"title":"SpeakerMatchRequest"},"SpeakerMatchResponse":{"properties":{"match_result":{"type":"string","title":"Match Result","description":"The LLM's response indicating whether the speaker names match.","example":"YES"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Error message if the LLM call failed.","example":"API key not found"}},"type":"object","required":["match_result"],"title":"SpeakerMatchResponse"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}